<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enhanced InfoMela Video & Banner Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Noto+Sans+Bengali:wght@600;700&display=swap" rel="stylesheet">
  <style>
    /* Base Styles */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 30px;
      color: #fff;
    }
    .main-container {
      max-width: 1600px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 400px 1fr;
      gap: 40px;
    }

    /* Control Panel */
    .control-panel {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 35px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      position: sticky;
      top: 30px;
      max-height: 95vh;
      overflow-y: auto;
    }
    .control-panel h1 { color: #667eea; font-size: 1.8rem; margin-bottom: 10px; font-weight: 800; }
    .control-panel p { color: #666; margin-bottom: 30px; font-size: 0.95rem; }
    .form-group { margin-bottom: 25px; }
    .form-group label {
      display: block; color: #333; font-weight: 700; margin-bottom: 10px; font-size: 0.95rem;
    }
    .form-group input[type="date"], .form-group textarea, .form-group select {
      width: 100%; padding: 14px; border: 2px solid #e0e0e0; border-radius: 10px;
      font-size: 1rem; font-family: inherit; transition: all 0.3s; background: #f9f9f9;
    }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      outline: none; border-color: #667eea; background: white;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }
    .form-group textarea { min-height: 80px; resize: vertical; }
    .upload-box {
      border: 3px dashed #667eea; border-radius: 15px; padding: 30px; text-align: center;
      cursor: pointer; transition: all 0.3s; background: #f0f4ff;
    }
    .upload-box:hover { background: #e6edff; border-color: #5568d3; transform: translateY(-2px); }
    .upload-box input { display: none; }
    .upload-icon { font-size: 3rem; margin-bottom: 10px; color: #667eea; }
    .upload-text { color: #667eea; font-weight: 600; font-size: 1rem; }
    .file-info { margin-top: 10px; font-size: 0.85rem; color: #666; }

    /* Video Options */
    .video-options {
      background: #f0f4ff; border-radius: 10px; padding: 15px; margin-top: 15px;
    }
    .video-options h4 {
      color: #667eea; margin-bottom: 12px; font-size: 0.95rem;
    }
    .duration-control {
      display: flex; align-items: center; gap: 10px; margin-bottom: 10px;
    }
    .duration-control label {
      color: #333; font-weight: 600; font-size: 0.9rem;
    }
    .duration-control input {
      flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #ddd;
    }

    /* Download Buttons */
    .btn-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #e0e0e0;
    }
    .btn-section h3 {
      color: #333;
      font-size: 1.1rem;
      margin-bottom: 15px;
      font-weight: 700;
    }
    .btn-download {
      width: 100%; padding: 18px; border: none; border-radius: 12px; font-size: 1.1rem;
      font-weight: 700; cursor: pointer; transition: all 0.3s; margin-top: 15px;
      text-transform: uppercase; letter-spacing: 0.5px;
    }
    .btn-english {
      background: linear-gradient(135deg, #eb4141 0%, #a50000 100%);
      color: white; box-shadow: 0 10px 30px rgba(171, 0, 0, 0.35);
    }
    .btn-bangla {
      background: linear-gradient(135deg, #ff9156 0%, #ff2b2b 100%);
      color: white; box-shadow: 0 10px 30px rgba(255, 58, 58, 0.4);
    }
    .btn-video {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }
    .btn-download:hover {
      transform: translateY(-3px); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }
    .btn-download:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Preview Section */
    .preview-section { display: flex; flex-direction: column; gap: 40px; }
    .preview-container {
      background: white; border-radius: 20px; padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    .preview-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0;
    }
    .preview-header h2 { color: #333; font-size: 1.5rem; font-weight: 700; }
    .lang-badge {
      background: linear-gradient(135deg, #eb4141 0%, #a50000 100%);
      color: white; padding: 8px 20px; border-radius: 20px; font-size: 0.9rem; font-weight: 700;
    }
    .lang-badge.bangla {
      background: linear-gradient(135deg, #ff9156 0%, #ff2b2b 100%);
    }

    /* Dynamic Banner Wrapper */
    .banner-wrapper {
      margin: 0 auto; padding: 18px;
      background: #f7f7f7; border-radius: 22px; border: 12px solid #d32f2f;
      position: relative; overflow: hidden; box-shadow: 0 25px 60px rgba(0, 0, 0, 0.35);
      transition: all 0.3s;
    }
    .banner {
      width: 100%; height: 100%; position: relative; background: white; border-radius: 16px;
      overflow: hidden; border: 3px solid rgba(211, 47, 47, 0.6);
      display: flex; flex-direction: column;
    }

    /* Top Strip */
    .top-strip {
      background: linear-gradient(90deg, rgba(211,47,47,1) 0%, rgba(166,0,0,1) 100%);
      color: white; padding: 18px 28px; display: flex; justify-content: space-between;
      align-items: center; position: relative; z-index: 2;
    }
    .brand-area {
      display: flex; align-items: center; gap: 12px; font-weight: 800; font-size: 1.25rem;
      text-transform: uppercase; letter-spacing: 1px;
    }
    .brand-logo {
      max-width: 110px; max-height: 48px; filter: brightness(0.85); opacity: 0.9;
    }
    .date-badge {
      background: rgba(255,255,255,0.18); padding: 8px 18px; border-radius: 30px;
      font-weight: 700; font-size: 0.9rem; letter-spacing: 0.5px;
      border: 1px solid rgba(255,255,255,0.3);
    }

    /* Image Panel */
    .image-panel {
      position: relative;
      flex-grow: 1;
      margin: 0 28px;
      margin-top: 15px;
      border-radius: 14px;
      overflow: hidden;
      border: 6px solid rgba(211, 47, 47, 0.85);
      box-shadow: 0 12px 28px rgba(0,0,0,0.25);
    }
    .image-panel img {
      width: 100%; height: 100%; object-fit: cover;
      filter: brightness(1.05) contrast(1.1) saturate(1.05);
    }
    .image-overlay {
      position: absolute; inset: 0; background: linear-gradient(180deg, rgba(0,0,0,0.25) 0%, rgba(0,0,0,0.6) 100%);
    }

    /* Headline Area */
    .headline-area {
      margin: 15px 28px 10px;
      padding: 18px 22px; background: #fff;
      border-radius: 12px; border: 1px solid rgba(211, 47, 47, 0.35);
      box-shadow: 0 10px 18px rgba(0, 0, 0, 0.1);
    }
    .headline-text {
      color: #c80000;
      font-weight: 800; line-height: 1.4;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    /* CTA Ribbon */
    .cta-ribbon {
      margin: 0 28px 15px;
      padding: 14px 26px;
      background: linear-gradient(90deg, rgba(211,47,47,1) 0%, rgba(166,0,0,1) 100%);
      color: white; font-weight: 800; text-transform: uppercase;
      letter-spacing: 1px; border-radius: 12px; text-align: center;
      box-shadow: 0 8px 20px rgba(211,47,47,0.45);
    }
    .cta-ribbon.hidden {
      display: none;
    }

    /* Footer Bar */
    .footer-bar {
      background: #222; padding: 16px 15px;
      display: flex; justify-content: center; align-items: center; gap: 18px;
      border-top: 3px solid rgba(211, 47, 47, 0.8);
      flex-wrap: wrap;
    }
    .social-item {
      display: flex; align-items: center; gap: 6px;
      font-size: 0.9rem;
      font-weight: 700; color: white;
    }
    .social-icon {
      width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center;
      justify-content: center; font-size: 0.9rem; font-weight: 700; color: #fff;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .icon-facebook { background: #1877F2; }
    .icon-twitter { background: #000; }
    .icon-youtube { background: #FF0000; }
    .icon-instagram {
      background: linear-gradient(45deg,#f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
    }

    .bangla-text { font-family: 'Noto Sans Bengali', sans-serif; }

    /* Progress indicator */
    .progress-indicator {
      margin-top: 15px;
      padding: 12px;
      background: #f0f4ff;
      border-radius: 8px;
      text-align: center;
      font-size: 0.9rem;
      color: #667eea;
      font-weight: 600;
      display: none;
    }
    .progress-indicator.active {
      display: block;
    }

    /* Animation effects */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideInUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes zoomIn {
      from { transform: scale(1.05); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .animate-fadeIn { animation: fadeIn 0.8s ease-out; }
    .animate-slideInUp { animation: slideInUp 0.8s ease-out; }
    .animate-zoomIn { animation: zoomIn 1.2s ease-out; }

    /* Advanced Options */
    .advanced-options {
      margin-top: 25px;
      border-top: 2px solid #e0e0e0;
      padding-top: 20px;
    }
    .advanced-toggle {
      display: flex; align-items: center; justify-content: space-between;
      cursor: pointer; padding: 12px; background: #f0f4ff; border-radius: 10px;
      transition: all 0.3s;
    }
    .advanced-toggle:hover {
      background: #e6edff;
    }
    .advanced-content {
      margin-top: 15px;
      display: none;
    }
    .advanced-content.active {
      display: block;
    }

    /* Customization Options */
    .customization-group {
      margin-bottom: 15px;
    }
    .customization-group label {
      display: block; color: #333; font-weight: 600; margin-bottom: 8px;
    }
    .customization-group input[type="range"] {
      width: 100%;
    }
    .color-picker {
      width: 100%; height: 40px; border-radius: 8px;
      border: 1px solid #ddd; padding: 0;
    }

    @media (max-width: 1200px) {
      .main-container { grid-template-columns: 1fr; }
      .control-panel { position: static; max-height: none; }
    }
  </style>
</head>
<body>

<div class="main-container">
  <!-- CONTROL PANEL -->
  <div class="control-panel">
    <h1>🎬 Enhanced InfoMela Video Studio</h1>
    <p>Create banners & videos with dynamic sizing and perfect 30-second duration</p>

    <div class="form-group">
      <label>📅 Date</label>
      <input type="date" id="bannerDate">
    </div>

    <div class="form-group">
      <label>🎥 Video Platform & Ratio</label>
      <select id="platformSelect">
        <option value="fb-square">Facebook - Square (1:1)</option>
        <option value="fb-landscape">Facebook - Landscape (16:9)</option>
        <option value="fb-portrait">Facebook - Portrait (4:5)</option>
        <option value="twitter-landscape">Twitter/X - Landscape (16:9)</option>
        <option value="twitter-square">Twitter/X - Square (1:1)</option>
        <option value="ig-feed">Instagram - Feed (1:1)</option>
        <option value="ig-portrait">Instagram - Portrait (4:5)</option>
        <option value="ig-story">Instagram - Story/Reel (9:16)</option>
        <option value="youtube">YouTube - Standard (16:9)</option>
      </select>
    </div>

    <div class="form-group">
      <label>🖼️ Logo Upload</label>
      <div class="upload-box" onclick="document.getElementById('logoInput').click()">
        <input type="file" id="logoInput" accept="image/*">
        <div class="upload-icon">📷</div>
        <div class="upload-text">Click to upload logo</div>
        <div class="file-info" id="logoInfo">PNG or SVG recommended</div>
      </div>
    </div>

    <div class="form-group">
      <label>📸 Headline Image</label>
      <div class="upload-box" onclick="document.getElementById('imageInput').click()">
        <input type="file" id="imageInput" accept="image/*">
        <div class="upload-icon">🖼️</div>
        <div class="upload-text">Click to upload image</div>
        <div class="file-info" id="imageInfo">Auto enhanced & upscaled</div>
      </div>
    </div>

    <div class="form-group">
      <label>✍️ English Headline</label>
      <textarea id="captionEN">HASINA BUILT A MOSQUE IN DHAKA; WHAT WOULD BNP DO?</textarea>
    </div>

    <div class="form-group">
      <label>✍️ বাংলা শিরোনাম</label>
      <textarea id="captionBN" class="bangla-text">হাসিনা সৌদি ফেরত ঢাকায় মসজিদ তৈরি করেছে; বিএনপি ক্ষমতায় গেলে মন্দির তৈরি করবে?</textarea>
    </div>

    <!-- VIDEO OPTIONS -->
    <div class="video-options">
      <h4>🎬 Video Settings</h4>
      <div class="duration-control">
        <label for="videoDuration">Duration (seconds):</label>
      <input type="number" id="videoDuration" min="5" max="120" value="30">
      </div>
      <div class="duration-control">
        <label for="fps">Frame Rate:</label>
      <select id="fps">
        <option value="24">24 FPS (Cinematic)</option>
        <option value="30" selected>30 FPS (Standard)</option>
        <option value="60">60 FPS (Smooth)</option>
      </select>
    </div>

    <!-- ADVANCED OPTIONS -->
    <div class="advanced-options">
      <div class="advanced-toggle" onclick="toggleAdvancedOptions()">
        <span>⚙️ Advanced Options</span>
        <span id="advancedArrow">▼</span>
      </div>
      <div class="advanced-content" id="advancedContent">
        <div class="customization-group">
          <label>Animation Speed</label>
          <input type="range" id="animationSpeed" min="0.5" max="3" step="0.1" value="1">
        </div>
        <div class="customization-group">
          <label>Zoom Effect</label>
          <input type="range" id="zoomEffect" min="0" max="20" step="1" value="5">
        </div>
        <div class="customization-group">
          <label>Background Color</label>
          <input type="color" id="bgColor" value="#ffffff">
        </div>
      </div>
    </div>

    <!-- IMAGE DOWNLOADS -->
    <div class="btn-section">
      <h3>📥 Download Static Images</h3>
      <button class="btn-download btn-english" onclick="downloadBanner('english', 'image')">
        Download English Image
      </button>
      <button class="btn-download btn-bangla" onclick="downloadBanner('bangla', 'image')">
        বাংলা ছবি ডাউনলোড করুন
      </button>
    </div>

    <!-- VIDEO DOWNLOADS -->
    <div class="btn-section">
      <h3>🎬 Download Videos</h3>
      <button class="btn-download btn-video" id="btnVideoEN" onclick="downloadBanner('english', 'video')">
        🎥 Download English Video
      </button>
      <button class="btn-download btn-video" id="btnVideoBN" onclick="downloadBanner('bangla', 'video')">
        🎥 বাংলা ভিডিও ডাউনলোড করুন
      </button>
      <div class="progress-indicator" id="progressIndicator">
        Generating video... Please wait ⏳
      </div>
    </div>
  </div>

  <!-- PREVIEW SECTION -->
  <div class="preview-section">
    <!-- ENGLISH PREVIEW -->
    <div class="preview-container">
      <div class="preview-header">
        <h2>English Preview</h2>
        <span class="lang-badge">ENGLISH</span>
      </div>
      <div class="banner-wrapper" id="frameEN">
        <div class="banner" id="bannerEN">
          <div class="top-strip">
            <div class="brand-area">
              <img class="brand-logo" id="logoEN" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='48' viewBox='0 0 200 80'%3E%3Crect fill='%23ffffff' width='200' height='80' rx='10'/%3E%3Ctext x='100' y='50' font-family='Arial' font-size='32' font-weight='bold' fill='%23d32f2f' text-anchor='middle'%3EInfoMela%3C/text%3E%3C/svg%3E" alt="Logo">
              <span>News.Fun.Facts</span>
            </div>
            <div class="date-badge" id="dateEN">14 OCTOBER 2025</div>
          </div>

          <div class="image-panel">
            <img id="bgImageEN" src="https://images.unsplash.com/photo-1504711434969-e33886168f5c?auto=format&fit=crop&w=1500&q=80" alt="Headline">
            <div class="image-overlay"></div>
          </div>

          <div class="headline-area">
            <div class="headline-text" id="captionDisplayEN">
              HASINA BUILT A MOSQUE IN DHAKA; WHAT WOULD BNP DO?
            </div>
          </div>

          <div class="cta-ribbon" id="ctaEN">DETAILS IN COMMENTS</div>

          <div class="footer-bar">
            <div class="social-item">
              <div class="social-icon icon-facebook">f</div>
              <span>@theinfomelaa</span>
            </div>
            <div class="social-item">
              <div class="social-icon icon-twitter">𝕏</div>
              <span>@theinfomela</span>
            </div>
            <div class="social-item">
              <div class="social-icon icon-youtube">▶</div>
              <span>@theinfomela</span>
            </div>
            <div class="social-item">
              <div class="social-icon icon-instagram">⧉</div>
              <span>@theinfomela</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- BANGLA PREVIEW -->
    <div class="preview-container">
      <div class="preview-header">
        <h2>বাংলা প্রিভিউ</h2>
        <span class="lang-badge bangla">বাংলা</span>
      </div>
      <div class="banner-wrapper" id="frameBN">
        <div class="banner" id="bannerBN">
          <div class="top-strip">
            <div class="brand-area bangla-text">
              <img class="brand-logo" id="logoBN" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='48' viewBox='0 0 200 80'%3E%3Crect fill='%23ffffff' width='200' height='80' rx='10'/%3E%3Ctext x='100' y='50' font-family='Arial' font-size='32' font-weight='bold' fill='%23d32f2f' text-anchor='middle'%3Eইনফো মেলা%3C/text%3E%3C/svg%3E" alt="Logo">
              <span>খবর.মজা.তথ্য</span>
            </div>
            <div class="date-badge bangla-text" id="dateBN">১৪ অক্টোবর ২০২৫</div>
          </div>

          <div class="image-panel">
            <img id="bgImageBN" src="https://images.unsplash.com/photo-1504711434969-e33886168f5c?auto=format&fit=crop&w=1500&q=80" alt="Headline">
            <div class="image-overlay"></div>
          </div>

          <div class="headline-area bangla-text">
            <div class="headline-text bangla-text" id="captionDisplayBN">
              হাসিনা সৌদি ফেরত ঢাকায় মসজিদ তৈরি করেছে; বিএনপি ক্ষমতায় গেলে মন্দির তৈরি করবে?
            </div>
          </div>

          <div class="cta-ribbon bangla-text" id="ctaBN">বিস্তারিত কমেন্টে</div>

          <div class="footer-bar">
            <div class="social-item">
              <div class="social-icon icon-facebook">f</div>
              <span>@theinfomelaa</span>
            </div>
            <div class="social-item">
              <div class="social-icon icon-twitter">𝕏</div>
              <span>@theinfomela</span>
            </div>
            <div class="social-item">
              <div class="social-icon icon-youtube">▶</div>
              <span>@theinfomela</span>
            </div>
            <div class="social-item">
              <div class="social-icon icon-instagram">⧉</div>
              <span>@theinfomela</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Enhanced platform aspect ratios (width:height)
  const PLATFORM_RATIOS = {
    'fb-square': { width: 1080, height: 1080 },
    'fb-landscape': { width: 1280, height: 720 },
    'fb-portrait': { width: 1080, height: 1350 },
    'twitter-landscape': { width: 1280, height: 720 },
    'twitter-square': { width: 1080, height: 1080 },
    'ig-feed': { width: 1080, height: 1080 },
    'ig-portrait': { width: 1080, height: 1350 },
    'ig-story': { width: 1080, height: 1920 },
    'youtube': { width: 1920, height: 1080 }
  };

  // Video configuration
  let videoConfig = {
    duration: 30,
    fps: 30,
    animationSpeed: 1,
    zoomEffect: 5
  };

  // Animation state
  let animationState = {
    currentFrame: 0,
    totalFrames: 0,
    startTime: 0
  };

  document.addEventListener('DOMContentLoaded', () => {
    const today = new Date();
    document.getElementById('bannerDate').value = today.toISOString().split('T')[0];
    updateDate();
    
    document.getElementById('bannerDate').addEventListener('change', updateDate);
    document.getElementById('platformSelect').addEventListener('change', updatePlatformRatio);
    document.getElementById('logoInput').addEventListener('change', handleLogoUpload);
    document.getElementById('imageInput').addEventListener('change', handleImageUpload);
    document.getElementById('captionEN').addEventListener('input', updateCaptions);
    document.getElementById('captionBN').addEventListener('input', updateCaptions);
    
    // Video settings
    document.getElementById('videoDuration').addEventListener('change', updateVideoDuration);
    document.getElementById('fps').addEventListener('change', updateFPS);
    document.getElementById('animationSpeed').addEventListener('input', updateAnimationSpeed);
    document.getElementById('zoomEffect').addEventListener('input', updateZoomEffect);
    document.getElementById('bgColor').addEventListener('change', updateBackgroundColor);
    
    updateCaptions();
    updatePlatformRatio();
  });

  function toggleAdvancedOptions() {
    const content = document.getElementById('advancedContent');
    const arrow = document.getElementById('advancedArrow');
    
    content.classList.toggle('active');
    arrow.textContent = content.classList.contains('active') ? '▲' : '▼';
  }

  function updateVideoDuration(e) {
    videoConfig.duration = parseInt(e.target.value);
  }

  function updateFPS(e) {
    videoConfig.fps = parseInt(e.target.value);
  }

  function updateAnimationSpeed(e) {
    videoConfig.animationSpeed = parseFloat(e.target.value);
  }

  function updateZoomEffect(e) {
    videoConfig.zoomEffect = parseInt(e.target.value);
  }

  function updateBackgroundColor(e) {
    const color = e.target.value;
    document.querySelectorAll('.banner').forEach(banner => {
      banner.style.backgroundColor = color;
    });
  }

  function updatePlatformRatio() {
    const platform = document.getElementById('platformSelect').value;
    const ratio = PLATFORM_RATIOS[platform];
    
    // Calculate dynamic height based on content
    const calculatedHeight = calculateDynamicHeight();
    
    // Update wrapper sizes for preview (scaled down for display)
    const displayScale = 715; // Base display width
    const displayHeight = Math.max(
      Math.round((ratio.height / ratio.width) * displayScale),
      calculatedHeight
    );
    
    document.querySelectorAll('.banner-wrapper').forEach(wrapper => {
      wrapper.style.width = displayScale + 'px';
      wrapper.style.height = displayHeight + 'px';
    });
  }

  function calculateDynamicHeight() {
    // Calculate height based on content length
    const enCaption = document.getElementById('captionEN').value;
    const bnCaption = document.getElementById('captionBN').value;
    
    // Base height for content
    let baseHeight = 600;
    
    // Calculate additional height needed for text
    const enLines = Math.ceil(enCaption.length / 35); // Approximate characters per line
    const bnLines = Math.ceil(bnCaption.length / 25); // Approximate characters per line for Bangla
    
    // Add extra height for longer captions
    const extraHeight = Math.max(enLines - 3, bnLines - 3, 0);
    const additionalHeight = extraHeight * 30; // Approximate pixels per line
    
    return baseHeight + additionalHeight;
  }

  function updateDate() {
    const dateStr = document.getElementById('bannerDate').value;
    if (!dateStr) return;
    const date = new Date(dateStr + 'T00:00:00');

    const optionsEN = { year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('dateEN').textContent = date.toLocaleDateString('en-GB', optionsEN).toUpperCase();

    const monthsBN = ['জানুয়ারি','ফেব্রুয়ারি','মার্চ','এপ্রিল','মে','জুন','জুলাই','আগস্ট','সেপ্টেম্বর','অক্টোবর','নভেম্বর','ডিসেম্বর'];
    const bnDay = date.getDate();
    const bnMonth = monthsBN[date.getMonth()];
    const bnYear = date.getFullYear();
    document.getElementById('dateBN').textContent = `${bnDay} ${bnMonth} ${bnYear}`;
  }

  function updateCaptions() {
    const enCaption = document.getElementById('captionEN').value;
    const bnCaption = document.getElementById('captionBN').value;
    
    // Auto-adjust font size based on text length
    const enDisplay = document.getElementById('captionDisplayEN');
    const bnDisplay = document.getElementById('captionDisplayBN');
    
    enDisplay.textContent = enCaption;
    bnDisplay.textContent = bnCaption;
    
    // Adjust font size for longer text
    const enFontSize = Math.max(1.0, 1.5 - (enCaption.length / 150));
    
    enDisplay.style.fontSize = `${enFontSize}rem`;
    bnDisplay.style.fontSize = `${enFontSize}rem`;
    
    // Update dynamic height after caption change
    updatePlatformRatio();
  }

  function handleLogoUpload(e) {
    const file = e.target.files[0];
    if (!file) return;
    document.getElementById('logoInfo').textContent = file.name;

    const reader = new FileReader();
    reader.onload = (event) => {
      document.getElementById('logoEN').src = event.target.result;
      document.getElementById('logoBN').src = event.target.result;
      extractDominantColor(event.target.result);
    };
    reader.readAsDataURL(file);
  }

  function extractDominantColor(src) {
    const img = new Image();
    img.crossOrigin = 'Anonymous';
    img.onload = function() {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
      const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

      let r = 0, g = 0, b = 0, count = 0;
      for (let i = 0; i < data.length; i += 4) {
        if (data[i+3] > 120) {
          r += data[i];
          g += data[i + 1];
          b += data[i + 2];
          count++;
        }
      }
      if (count === 0) return;

      r = Math.round(r / count);
      g = Math.round(g / count);
      b = Math.round(b / count);
      const hex = '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
      applyBrandColor(hex);
    };
    img.src = src;
  }

  function applyBrandColor(color) {
    const frameWrappers = document.querySelectorAll('.banner-wrapper');
    frameWrappers.forEach(frame => {
      frame.style.borderColor = color;
    });

    const elementsToTint = [
      { selector: '.banner', prop: 'borderColor', color: shadeColor(color, -20), opacity: 0.6 },
      { selector: '.top-strip', prop: 'background', gradient: true, color1: color, color2: shadeColor(color, -40) },
      { selector: '.cta-ribbon', prop: 'background', gradient: true, color1: color, color2: shadeColor(color, -40) },
      { selector: '.image-panel', prop: 'borderColor', color: shadeColor(color, -20), opacity: 0.85 },
      { selector: '.headline-area', prop: 'borderColor', color: color, opacity: 0.35 },
      { selector: '.footer-bar', prop: 'borderTopColor', color: color, opacity: 0.8 }
    ];

    elementsToTint.forEach(item => {
      document.querySelectorAll(item.selector).forEach(el => {
        if (item.gradient) {
          el.style[item.prop] = `linear-gradient(90deg, ${item.color1} 0%, ${item.color2} 100%)`;
        } else {
          let finalColor = item.color || color;
          if (item.opacity) {
            const rgba = hexToRgba(finalColor, item.opacity);
            el.style[item.prop] = rgba;
          } else {
            el.style[item.prop] = finalColor;
          }
        }
      });
    });

    document.querySelectorAll('.headline-text').forEach(el => {
      el.style.color = shadeColor(color, -10);
    });
  }

  function shadeColor(color, percent) {
    const num = parseInt(color.slice(1), 16);
    const amt = Math.round(2.55 * percent);
    let R = (num >> 16) + amt;
    let G = (num >> 8 & 0x00FF) + amt;
    let B = (num & 0x0000FF) + amt;
    return '#' + (
      0x1000000 +
      (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
      (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
      (B < 255 ? (B < 1 ? 0 : B) : 255)
    ).toString(16).slice(1).toUpperCase();
  }

  function hexToRgba(hex, alpha) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
  }

  function handleImageUpload(e) {
    const file = e.target.files[0];
    if (!file) return;
    document.getElementById('imageInfo').textContent = file.name;

    const reader = new FileReader();
    reader.onload = (event) => {
      const img = new Image();
      img.onload =() => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.filter = 'brightness(1.08) contrast(1.1) saturate(1.08)';
        ctx.drawImage(img, 0, 0, img.width, img.height);
        const enhanced = canvas.toDataURL('image/jpeg', 0.98);
        document.getElementById('bgImageEN').src = enhanced;
        document.getElementById('bgImageBN').src = enhanced;
      };
      img.src = event.target.result;
    };
    reader.readAsDataURL(file);
  }

  async function downloadBanner(lang, type) {
    const bannerId = lang === 'english' ? 'bannerEN' : 'bannerBN';
    const ctaId = lang === 'english' ? 'ctaEN' : 'ctaBN';
    const platform = document.getElementById('platformSelect').value;
    const ratio = PLATFORM_RATIOS[platform];

    // Hide CTA ribbon for video
    const ctaElement = document.getElementById(ctaId);
    const originalDisplay = ctaElement.style.display;
    if (type === 'video') {
      ctaElement.classList.add('hidden');
    }

    if (type === 'image') {
      await downloadImage(bannerId, lang, ratio);
    } else {
      await downloadVideo(bannerId, lang, ratio);
    }

    // Restore CTA ribbon
    if (type === 'video') {
      ctaElement.classList.remove('hidden');
    }
  }

  async function downloadImage(bannerId, lang, ratio) {
    const banner = document.getElementById(bannerId);
    
    if (typeof html2canvas === 'undefined') {
      await loadScript('https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js');
    }

    html2canvas(banner, {
      scale: 3,
      useCORS: true,
      allowTaint: true,
      backgroundColor: '#ffffff',
      width: ratio.width,
      height: ratio.height,
      logging: false
    }).then(canvas => {
      const link = document.createElement('a');
      link.download = `InfoMela_${lang}_${Date.now()}.png`;
      link.href = canvas.toDataURL('image/png', 1.0);
      link.click();
    });
  }

  async function downloadVideo(bannerId, lang, ratio) {
    const progressIndicator = document.getElementById('progressIndicator');
    const btnEN = document.getElementById('btnVideoEN');
    const btnBN = document.getElementById('btnVideoBN');
    
    // Disable buttons and show progress
    btnEN.disabled = true;
    btnBN.disabled = true;
    progressIndicator.classList.add('active');

    try {
      const banner = document.getElementById(bannerId);
      
      if (typeof html2canvas === 'undefined') {
      await loadScript('https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js');
      }

      // Create canvas for video frames
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = ratio.width;
      canvas.height = ratio.height;

      // Calculate total frames
      const totalFrames = videoConfig.duration * videoConfig.fps;
      
      // Create video recorder
      const stream = canvas.captureStream(videoConfig.fps);
      const mediaRecorder = new MediaRecorder(stream, {
        mimeType: 'video/webm;codecs=vp9',
        videoBitsPerSecond: 8000000 // 8 Mbps for high quality
      });

      const chunks = [];
      mediaRecorder.ondataavailable = (e) => {
      if (e.data.size > 0) {
        chunks.push(e.data);
      }
      };

      mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `InfoMela_${lang}_video_${Date.now()}.webm`;
        link.click();
        URL.revokeObjectURL(url);

        // Re-enable buttons
        btnEN.disabled = false;
        btnBN.disabled = false;
        progressIndicator.classList.remove('active');
      };

      mediaRecorder.start();
      
      // Record for specified duration with animation
      await recordAnimatedVideo(canvas, ctx, banner, totalFrames, mediaRecorder);

    } catch (error) {
      console.error('Video generation failed:', error);
      alert('Video generation failed. Please try again.');
      btnEN.disabled = false;
      btnBN.disabled = false;
      progressIndicator.classList.remove('active');
    }
  }

  async function recordAnimatedVideo(canvas, ctx, banner, totalFrames, mediaRecorder) {
    return new Promise((resolve) => {
      let frameCount = 0;
      
      function captureFrame() {
        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Calculate animation progress (0 to 1)
        const progress = frameCount / totalFrames;
        
        // Apply animations to the banner
        applyVideoAnimations(banner, progress);
        
        // Render the banner to canvas
        html2canvas(banner, {
          scale: 1,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#ffffff',
          width: canvas.width,
          height: canvas.height,
          logging: false,
          canvas: canvas
        }).then(() => {
          frameCount++;
          
          if (frameCount < totalFrames) {
          setTimeout(captureFrame, 1000 / videoConfig.fps);
        } else {
          mediaRecorder.stop();
          resolve();
        }
      }
      
      // Start capturing frames
      captureFrame();
    });
  }

  function applyVideoAnimations(banner, progress) {
    // Reset transforms
    banner.style.transform = '';
    
    // Apply zoom effect
    const zoomAmount = 1 + (videoConfig.zoomEffect / 100) * Math.sin(progress * Math.PI);
    
    // Apply subtle movements
    const translateX = Math.sin(progress * Math.PI * 4) * 3;
    const translateY = Math.cos(progress * Math.PI * 2) * 2;
    
    // Apply overall animation
    banner.style.transform = `scale(${zoomAmount}) translate(${translateX}px, ${translateY}px)`;
    
    // Apply fade effects to different elements
    const elements = banner.querySelectorAll('.headline-text, .image-panel, .cta-ribbon');
    
    elements.forEach(el => {
      // Reset opacity
      el.style.opacity = '1';
      
      // Apply subtle pulsing to text
      if (el.classList.contains('headline-text')) {
      const pulse = 0.95 + 0.05 * Math.sin(progress * Math.PI * 8));
      el.style.transform = `scale(${pulse})`;
    });
  }

  function loadScript(src) {
    return new Promise((resolve, reject) => {
      const script = document.createElement('script');
      script.src = src;
      script.onload = resolve;
      script.onerror = reject;
      document.head.appendChild(script);
    });
  }
</script>
</body>
</html>
