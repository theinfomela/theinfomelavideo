<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Info Mela Banner & Video Maker</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Noto+Sans+Bengali:wght@600;700&display=swap" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  min-height:100vh;padding:30px;color:#fff
}
.main-container{max-width:1600px;margin:auto;display:grid;grid-template-columns:400px 1fr;gap:40px}
.control-panel{
  background:rgba(255,255,255,0.95);border-radius:20px;padding:35px;
  box-shadow:0 20px 60px rgba(0,0,0,.3);
  position:sticky;top:30px;max-height:95vh;overflow-y:auto
}
.control-panel h1{color:#667eea;font-size:1.8rem;margin-bottom:10px;font-weight:800}
.control-panel p{color:#666;margin-bottom:30px;font-size:.95rem}
.form-group{margin-bottom:25px}
.form-group label{display:block;color:#333;font-weight:700;margin-bottom:10px;font-size:.95rem}
.form-group input,.form-group textarea,.form-group select{
  width:100%;padding:14px;border:2px solid #e0e0e0;border-radius:10px;font-size:1rem;
  background:#f9f9f9;transition:all .3s;font-family:inherit
}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{
  outline:none;border-color:#667eea;background:white;
  box-shadow:0 0 0 4px rgba(102,126,234,.1)
}
.upload-box{
  border:3px dashed #667eea;border-radius:15px;padding:30px;text-align:center;
  cursor:pointer;transition:all .3s;background:#f0f4ff;position:relative
}
.upload-box input{position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;cursor:pointer}
.upload-box:hover{background:#e6edff;border-color:#5568d3;transform:translateY(-2px)}
.upload-icon{font-size:3rem;margin-bottom:10px;color:#667eea}
.upload-text{color:#667eea;font-weight:600;font-size:1rem}
.file-info{margin-top:10px;font-size:.85rem;color:#666}
.video-options{background:#f0f4ff;border-radius:10px;padding:15px;margin-top:15px}
.video-options h4{color:#667eea;margin-bottom:12px;font-size:.95rem}
.option-row{display:flex;align-items:center;gap:10px;margin-bottom:12px}
.option-row label{color:#333;font-weight:600;font-size:.9rem;min-width:140px}
.option-row input,.option-row select{flex:1;padding:10px;border-radius:8px;border:1px solid #ccc}
.advanced-toggle{
  margin-top:22px;padding:12px 16px;border-radius:10px;background:#f0f4ff;
  display:flex;justify-content:space-between;align-items:center;cursor:pointer;transition:.3s
}
.advanced-toggle:hover{background:#e6edff}
.advanced-content{display:none;margin-top:16px}
.advanced-content.active{display:block}
.range-row{margin-bottom:14px}
.range-row label{display:block;margin-bottom:6px;font-weight:600;color:#333}
.range-row input[type=range]{width:100%}
.btn-section{margin-top:30px;padding-top:20px;border-top:2px solid #e0e0e0}
.btn-section h3{color:#333;font-size:1.1rem;margin-bottom:15px;font-weight:700}
.btn-download{
  width:100%;padding:18px;border:none;border-radius:12px;
  font-size:1.1rem;font-weight:700;cursor:pointer;
  transition:all .3s;margin-top:15px;text-transform:uppercase;letter-spacing:.5px
}
.btn-english{background:linear-gradient(135deg,#eb4141 0%,#a50000 100%);color:#fff;box-shadow:0 10px 30px rgba(171,0,0,.35)}
.btn-bangla{background:linear-gradient(135deg,#ff9156 0%,#ff2b2f 100%);color:#fff;box-shadow:0 10px 30px rgba(255,58,58,.4)}
.btn-video{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;box-shadow:0 10px 30px rgba(102,126,234,.4)}
.btn-download:hover{transform:translateY(-3px);box-shadow:0 15px 40px rgba(0,0,0,.3)}
.btn-download:disabled{opacity:.55;cursor:not-allowed;transform:none}
.progress-indicator{
  margin-top:15px;padding:12px;background:#f0f4ff;border-radius:8px;
  text-align:center;font-size:.9rem;color:#667eea;font-weight:600;display:none
}
.progress-indicator.active{display:block}
.preview-section{display:flex;flex-direction:column;gap:40px}
.preview-container{
  background:#fff;border-radius:20px;padding:30px;
  box-shadow:0 20px 60px rgba(0,0,0,.3);color:#000
}
.preview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;padding-bottom:15px;border-bottom:2px solid #f0f0f0}
.preview-header h2{color:#333;font-size:1.5rem;font-weight:700}
.lang-badge{background:linear-gradient(135deg,#eb4141 0%,#a50000 100%);color:#fff;padding:8px 20px;border-radius:20px;font-size:.9rem;font-weight:700}
.lang-badge.bangla{background:linear-gradient(135deg,#ff9156 0%,#ff2b2f 100%)}
.banner-wrapper{
  margin:0 auto;padding:18px;background:#f7f7f7;border-radius:22px;border:12px solid #d32f2f;
  position:relative;overflow:hidden;box-shadow:0 25px 60px rgba(0,0,0,.35);
  transition:all .3s;width:100%;max-width:720px
}
.banner{
  width:100%;min-height:520px;position:relative;background:#fff;border-radius:16px;
  overflow:hidden;border:3px solid rgba(211,47,47,.6);display:flex;flex-direction:column
}
.top-strip{
  background:linear-gradient(90deg,#d32f2f 0%,#a50000 100%);color:#fff;padding:18px 28px;
  display:flex;justify-content:space-between;align-items:center;z-index:2
}
.brand-area{display:flex;align-items:center;gap:12px;font-weight:800;font-size:1.25rem;text-transform:uppercase;letter-spacing:1px}
.brand-logo{max-width:110px;max-height:48px;filter:brightness(.92);opacity:.95}
.slogan{font-size:.9rem;color:rgba(255,255,255,.9);font-weight:500}
.date-badge{background:rgba(255,255,255,.18);padding:8px 18px;border-radius:30px;
  font-weight:700;font-size:.9rem;letter-spacing:.5px;border:1px solid rgba(255,255,255,.3)}
.image-panel{
  position:relative;flex-grow:1;margin:18px 28px;border-radius:14px;overflow:hidden;
  border:6px solid rgba(211,47,47,.85);box-shadow:0 12px 28px rgba(0,0,0,.25);
  background:#111;display:flex;align-items:center;justify-content:center
}
.image-panel img{width:100%;height:100%;object-fit:contain;background:#111}
.image-overlay{position:absolute;inset:0;pointer-events:none;
  background:linear-gradient(180deg,rgba(0,0,0,.12) 0%,rgba(0,0,0,.4) 100%)}
.headline-area{
  margin:0 28px 18px;padding:22px 26px;background:#c80000;border-radius:12px;
  border:1px solid rgba(211,47,47,.35);box-shadow:0 10px 18px rgba(0,0,0,.1);
  display:flex;align-items:center;justify-content:center;min-height:90px
}
.headline-text{color:#fff;font-weight:900;line-height:1.5;word-wrap:break-word;
  overflow-wrap:break-word;transition:font-size .2s ease;font-family:inherit;text-align:center}
.cta-ribbon{
  margin:0 28px 20px;padding:14px 26px;background:linear-gradient(90deg,rgba(211,47,47,1) 0%,rgba(166,0,0,1) 100%);
  color:#fff;font-weight:800;text-transform:uppercase;letter-spacing:1px;
  border-radius:12px;text-align:center;box-shadow:0 8px 20px rgba(211,47,47,.45)
}
.cta-ribbon.hidden{display:none}
.footer-bar{background:#222;padding:14px 10px;display:flex;justify-content:center;
  align-items:center;gap:12px;border-top:3px solid rgba(211,47,47,.8);
  flex-wrap:nowrap;margin-bottom:12px;overflow-x:auto}
.social-item{display:flex;align-items:center;gap:4px;font-size:0.8rem;font-weight:700;color:#fff}
.social-icon{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;
  justify-content:center;font-size:.8rem;color:#fff;box-shadow:0 4px 8px rgba(0,0,0,.3)}
.icon-facebook{background:#1877F2}
.icon-twitter{background:#000}
.icon-youtube{background:#FF0000}
.icon-instagram{background:linear-gradient(45deg,#f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%)}
.bangla-text{font-family:'Noto Sans Bengali',sans-serif}
@media(max-width:1200px){
  .main-container{grid-template-columns:1fr}
  .control-panel{position:static;max-height:none}
}
</style>
</head>

<body>
<div class="main-container">
  <!-- CONTROL PANEL -->
  <div class="control-panel">
    <h1>Info Mela Banner With Video Maker</h1>
    <p>Generate high‚Äëquality images & videos easily</p>

    <div class="form-group"><label>üìÖ Date</label><input type="date" id="bannerDate"></div>

    <div class="form-group">
      <label>üé• Platform Ratio</label>
      <select id="platformSelect">
        <option value="fb-square">Facebook ‚Äì Square</option><option value="fb-landscape">Facebook ‚Äì Landscape</option>
        <option value="fb-portrait">Facebook ‚Äì Portrait</option><option value="ig-story">Instagram Story/Reel</option>
        <option value="youtube">YouTube ‚Äì Standard 16:9</option>
      </select>
    </div>

    <div class="form-group"><label>üñºÔ∏è Logo Upload</label>
      <div class="upload-box">
        <input type="file" id="logoInput" accept="image/*">
        <div class="upload-icon">üì∑</div><div class="upload-text">Click to upload logo</div><div id="logoInfo" class="file-info"></div>
      </div>
    </div>

    <div class="form-group"><label>üì∏ Photo / Video Upload</label>
      <div class="upload-box">
        <input type="file" id="mediaInput" accept="image/*,video/*">
        <div class="upload-icon">üé•</div><div class="upload-text">Click to upload media</div><div id="mediaInfo" class="file-info"></div>
      </div>
    </div>

    <div class="form-group">
  <label>‚úçÔ∏è English Headline</label>
  <textarea id="captionEN" class="english-text">Caption Here</textarea>
</div>

<div class="form-group">
  <label>‚úçÔ∏è ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ</label>
  <textarea id="captionBN" class="bangla-text">Caption Here</textarea>
</div>

<style>
  /* üåê English text styling */
  .english-text {
    font-weight: bold;       /* Makes text bold */
    font-size: 40px;         /* Increases font size */
    font-family: "Arial", sans-serif; /* Clean readable font */
  }

  /* üáßüá© Bangla text styling */
  .bangla-text {
    font-weight: bold;       /* Makes text bold */
    font-size: 40px;         /* Increases font size */
    font-family: "Noto Sans Bengali", "SolaimanLipi", sans-serif; /* Smooth Bangla font */
  }
</style>

    <div class="video-options">
      <h4>üé¨ Video Settings</h4>
      <div class="option-row"><label>Duration (sec)</label><input type="number" id="videoDuration" min="5" max="15" value="10"></div>
      <div class="option-row"><label>Frame Rate</label>
        <select id="fps"><option value="24">24</option><option value="30" selected>30</option></select>
      </div>
    </div>

    <div class="advanced-toggle" onclick="toggleAdvancedOptions()">
      <span>‚öôÔ∏è Advanced Animations</span><span id="advancedArrow">‚ñº</span>
    </div>
    <div class="advanced-content" id="advancedContent">
      <div class="range-row"><label>Animation Speed</label><input type="range" id="animationSpeed" min="0.5" max="3" step="0.1" value="1"></div>
      <div class="range-row"><label>Zoom Intensity</label><input type="range" id="zoomEffect" min="0" max="20" step="1" value="5"></div>
      <div class="range-row"><label>Video Quality (%)</label><input type="range" id="quality" min="50" max="90" value="75" step="5"><span id="qualityValue">75%</span></div>
    </div>

    <div class="btn-section">
      <h3>üì• Download Static Images</h3>
      <button class="btn-download btn-english" onclick="downloadBanner('english','image')">Download English Image</button>
      <button class="btn-download btn-bangla" onclick="downloadBanner('bangla','image')">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶õ‡¶¨‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
    </div>

    <div class="btn-section">
      <h3>üé¨ Download Videos</h3>
      <button class="btn-download btn-video" onclick="downloadBanner('english','video')">üé• English Video</button>
      <button class="btn-download btn-video" onclick="downloadBanner('bangla','video')">üé• ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì</button>
      <div id="progressIndicator" class="progress-indicator">Working‚Ä¶</div>
    </div>
  </div>

  <!-- PREVIEWS -->
  <div class="preview-section">
    <div class="preview-container">
      <div class="preview-header"><h2>English Preview</h2><span class="lang-badge">ENGLISH</span></div>
      <div class="banner-wrapper"><div class="banner" id="bannerEN">
        <div class="top-strip"><div class="brand-area"><img class="brand-logo" id="logoEN"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='48'%3E%3Crect fill='%23fff' width='200' height='80' rx='10'/%3E%3Ctext x='100' y='50' font-family='Arial' font-size='32' font-weight='bold' fill='%23d32f2f' text-anchor='middle'%3EInfoMela%3C/text%3E%3C/svg%3E"><span class="slogan">News.Fun.Facts</span></div><div class="date-badge" id="dateEN">14 OCTOBER 2025</div></div>
        <div class="image-panel"><img id="bgImageEN" src="https://images.unsplash.com/photo-1504711434969-e33886168f5c?auto=format&fit=crop&w=1200&q=80"><div class="image-overlay"></div></div>
        <div class="headline-area"><div class="headline-text" id="captionDisplayEN"></div></div>
        <div class="cta-ribbon" id="ctaEN">DETAILS IN COMMENTS</div>
        <div class="footer-bar">
          <div class="social-item"><div class="social-icon icon-facebook">f</div><span>@theinfomelaa</span></div>
          <div class="social-item"><div class="social-icon icon-twitter">ùïè</div><span>@theinfomela</span></div>
          <div class="social-item"><div class="social-icon icon-youtube">‚ñ∂</div><span>@theinfomela</span></div>
          <div class="social-item"><div class="social-icon icon-instagram">‚ßâ</div><span>@theinfomela</span></div>
        </div>
      </div></div>
    </div>

    <div class="preview-container">
      <div class="preview-header"><h2>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</h2><span class="lang-badge bangla">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</span></div>
      <div class="banner-wrapper"><div class="banner bangla-text" id="bannerBN">
        <div class="top-strip"><div class="brand-area"><img class="brand-logo" id="logoBN"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='48'%3E%3Crect fill='%23fff' width='200' height='80' rx='10'/%3E%3Ctext x='100' y='50' font-family='Arial' font-size='32' font-weight='bold' fill='%23d32f2f' text-anchor='middle'%3E‡¶á‡¶®‡¶´‡ßã ‡¶Æ‡ßá‡¶≤‡¶æ%3C/text%3E%3C/svg%3E"><span class="slogan">‡¶ñ‡¶¨‡¶∞.‡¶Æ‡¶ú‡¶æ.‡¶§‡¶•‡ßç‡¶Ø</span></div><div class="date-badge" id="dateBN">‡ßß‡ß™ ‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞ ‡ß®‡ß¶‡ß®‡ß´</div></div>
        <div class="image-panel"><img id="bgImageBN" src="https://images.unsplash.com/photo-1504711434969-e33886168f5c?auto=format&fit=crop&w=1200&q=80"><div class="image-overlay"></div></div>
        <div class="headline-area"><div class="headline-text" id="captionDisplayBN"></div></div>
        <div class="cta-ribbon" id="ctaBN">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá</div>
        <div class="footer-bar">
          <div class="social-item"><div class="social-icon icon-facebook">f</div><span>@theinfomelaa</span></div>
          <div class="social-item"><div class="social-icon icon-twitter">ùïè</div><span>@theinfomela</span></div>
          <div class="social-item"><div class="social-icon icon-youtube">‚ñ∂</div><span>@theinfomela</span></div>
          <div class="social-item"><div class="social-icon icon-instagram">‚ßâ</div><span>@theinfomela</span></div>
        </div>
      </div></div>
    </div>
  </div>
</div>

<script>
const PLATFORM_RATIOS={
 'fb-square':{width:1080,height:1080},'fb-landscape':{width:1280,height:720},
 'fb-portrait':{width:1080,height:1350},'ig-story':{width:1080,height:1920},
 'youtube':{width:1920,height:1080}
};
const state={logoObjectURL:null,mediaObjectURL:null,mediaType:'image'};
const videoConfig={duration:10,fps:30,animationSpeed:1,zoomEffect:5,quality:75};

document.addEventListener('DOMContentLoaded',()=>{initUI();});
function initUI(){
  const today=new Date();
  bannerDate.value=today.toISOString().split('T')[0];
  updateDate();updateCaptions();updatePlatformRatio();
  bannerDate.addEventListener('change',updateDate);
  platformSelect.addEventListener('change',updatePlatformRatio);
  captionEN.addEventListener('input',updateCaptions);
  captionBN.addEventListener('input',updateCaptions);
  logoInput.addEventListener('change',handleLogoUpload);
  mediaInput.addEventListener('change',handleMediaUpload);
  videoDuration.addEventListener('change',e=>{videoConfig.duration=Math.max(5,Math.min(15,+e.target.value||10));});
  fps.addEventListener('change',e=>videoConfig.fps=+e.target.value);
  animationSpeed.addEventListener('input',e=>videoConfig.animationSpeed=+e.target.value);
  zoomEffect.addEventListener('input',e=>videoConfig.zoomEffect=+e.target.value);
  quality.addEventListener('input',e=>{videoConfig.quality=+e.target.value;qualityValue.textContent=videoConfig.quality+'%';});
}

function toggleAdvancedOptions(){
 const c=document.getElementById('advancedContent');const a=document.getElementById('advancedArrow');
 c.classList.toggle('active');a.textContent=c.classList.contains('active')?'‚ñ≤':'‚ñº';
}
function updateDate(){
 const d=new Date(bannerDate.value+'T00:00');
 const enOpt={year:'numeric',month:'long',day:'numeric'};
 dateEN.textContent=d.toLocaleDateString('en-GB',enOpt).toUpperCase();
 const bnMonths=['‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø','‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø','‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö','‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤','‡¶Æ‡ßá','‡¶ú‡ßÅ‡¶®','‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á','‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü','‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞','‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞','‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞','‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'];
 dateBN.textContent=`${d.getDate()} ${bnMonths[d.getMonth()]} ${d.getFullYear()}`;
}
function updateCaptions(){
 captionDisplayEN.textContent=captionEN.value.trim();
 captionDisplayBN.textContent=captionBN.value.trim();
}
function updatePlatformRatio(){
 const ratio=PLATFORM_RATIOS[platformSelect.value];
 const base=700;
 document.querySelectorAll('.banner-wrapper').forEach(w=>{
 const b=w.querySelector('.banner');
 w.style.width=base+'px';
 const expectedH=Math.round((ratio.height/ratio.width)*base);
 w.style.height=Math.max(expectedH,b.scrollHeight+40)+'px';
 });
}

/* Upload handlers */
function handleLogoUpload(e){
 const f=e.target.files[0];if(!f)return;
 const rd=new FileReader();
 rd.onload=ev=>{logoEN.src=logoBN.src=ev.target.result;};
 rd.readAsDataURL(f);
}
function handleMediaUpload(e){
 const f=e.target.files[0];if(!f)return;
 const isVideo=f.type.startsWith('video/');
 if(isVideo){
  const v=document.createElement('video');v.src=URL.createObjectURL(f);
  v.onloadeddata=()=>{
   const c=document.createElement('canvas');c.width=v.videoWidth;c.height=v.videoHeight;
   c.getContext('2d').drawImage(v,0,0);const data=c.toDataURL('image/jpeg',0.9);
   bgImageEN.src=bgImageBN.src=data;state.mediaType='video';
  };
 }else{
  const rd=new FileReader();rd.onload=ev=>{bgImageEN.src=bgImageBN.src=ev.target.result;state.mediaType='image';};
  rd.readAsDataURL(f);
 }
}

/* Download core */
async function downloadBanner(lang,type){
 const banner=document.getElementById(lang==='english'?'bannerEN':'bannerBN');
 const ratio=PLATFORM_RATIOS[platformSelect.value];
 const progress=document.getElementById('progressIndicator');
 progress.classList.add('active');
 try{
  if(type==='image')await downloadImage(banner,lang,ratio);
  else await downloadVideo(banner,lang,ratio);
 }catch(e){alert('Error: '+e.message);}
 finally{progress.classList.remove('active');}
}

async function downloadImage(banner,lang,ratio){
 const c=await html2canvas(banner,{scale:2,useCORS:true,allowTaint:true});
 const out=document.createElement('canvas');out.width=ratio.width;out.height=ratio.height;
 const ctx=out.getContext('2d');ctx.fillStyle='#fff';ctx.fillRect(0,0,out.width,out.height);
 ctx.drawImage(c,0,0,out.width,out.height);
 out.toBlob(b=>{
  const u=URL.createObjectURL(b);const a=document.createElement('a');
  a.href=u;a.download=`InfoMela_${lang}_${Date.now()}.jpg`;a.click();URL.revokeObjectURL(u);
 },'image/jpeg',0.95);
}

/* Working video generator from first version */
async function downloadVideo(banner,lang,ratio){
 const progress=document.getElementById('progressIndicator');
 progress.textContent='Generating video‚Ä¶';
 const canvas=await html2canvas(banner,{scale:1.5,useCORS:true,allowTaint:true,backgroundColor:'#fff'});
 const vcan=document.createElement('canvas');
 vcan.width=ratio.width;vcan.height=ratio.height;
 const ctx=vcan.getContext('2d');
 const types=['video/webm;codecs=vp9','video/webm;codecs=vp8','video/webm'];
 let mime=types.find(t=>MediaRecorder.isTypeSupported(t))||'video/webm';
 const stream=vcan.captureStream(videoConfig.fps);
 const recorder=new MediaRecorder(stream,{mimeType:mime,videoBitsPerSecond:2500000});
 const chunks=[];
 recorder.ondataavailable=e=>{if(e.data.size>0)chunks.push(e.data);};
 const total=videoConfig.duration*videoConfig.fps;let i=0;
 function draw(){
   const p=i/total;
   ctx.fillStyle='#fff';ctx.fillRect(0,0,vcan.width,vcan.height);
   const z=1+(videoConfig.zoomEffect/100)*Math.sin(p*Math.PI);
   const px=Math.sin(p*Math.PI*2)*20*videoConfig.animationSpeed;
   const py=Math.cos(p*Math.PI*2)*10*videoConfig.animationSpeed;
   ctx.save();ctx.translate(vcan.width/2+px,vcan.height/2+py);ctx.scale(z,z);
   ctx.drawImage(canvas,-vcan.width/2,-vcan.height/2,vcan.width,vcan.height);ctx.restore();
 }
 recorder.start();
 (function animate(){
   if(i<total){draw();i++;requestAnimationFrame(animate);}
   else{recorder.stop();}
 })();
 await new Promise(res=>recorder.onstop=res);
 const blob=new Blob(chunks,{type:mime});
 const url=URL.createObjectURL(blob);
 const a=document.createElement('a');a.href=url;a.download=`InfoMela_${lang}_video_${Date.now()}.webm`;
 document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
 progress.textContent='Video ready!';
 setTimeout(()=>progress.classList.remove('active'),1500);
}
</script>
</body>
</html>
